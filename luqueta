import time as t
import pyautogui as pa
import os
import sys
from PIL import Image

mainSize = (1920, 1080)
tamAtual = pa.size()
prop = (tamAtual[0] / mainSize[0], tamAtual[1] / mainSize[1])

def redimeTamanho(caminhoImagem): #recebe o caminho da imagem como argumento
    img = Image.open(caminhoImagem)  #abre a original para redimensionar
    imgRedimensionada = img.resize((int(img.size[0] * prop[0]), int(img.size[1] * prop[1]))) #redimensiona a imagem 
    caminhoRedimeTemp = f"temp_{os.path.basename(caminhoImagem)}"  #nomeio o arquivo temporario redimensionado
    imgRedimensionada.save(caminhoRedimeTemp) #salva a imagem redimensionada com o nome temporario
   
    return caminhoRedimeTemp #retorna o caminho da imagem redimensionada que vai ser usada pelo pyautogui

def resource_path(relative_path): #localiza o caminho em qualquer ambiente
    try:
        base_path = sys._MEIPASS  #base path como diretorio temporario usado pelo pyinstaller
    except Exception:
        base_path = os.path.abspath(".")  #se der ruim, esse avisa que estou tentando como script, e nao como .exe

    return os.path.join(base_path, relative_path)  #combina os caminhos 

gMsg_resized = redimeTamanho(resource_path('C:/Users/pedro/Desktop/workspace/gMsg.jpg'))  #redimensiona as imagens para res do monitor, usando a funÃ§Ã£o redimeTamanho 
gMsgR_resized = redimeTamanho(resource_path('C:/Users/pedro/Desktop/workspace/gMsgR.jpg'))
iniciarChat_resized = redimeTamanho(resource_path('C:/Users/pedro/Desktop/workspace/iniciarChat.jpg'))
digiteUm_resized = redimeTamanho(resource_path('C:/Users/pedro/Desktop/workspace/digiteUm.jpg'))                     #SEMPRE LEMBRAR DAS BARRAS PARA OS CAMINHOS

t.sleep(7)
pa.press("win")
t.sleep(1)
pa.typewrite("chr")
t.sleep(2)
pa.press("enter")
t.sleep(2)
pa.typewrite("google mensagens")
t.sleep(1)
pa.press("enter")

try:
    t.sleep(3)
    gMensagensRoxo = pa.locateCenterOnScreen(gMsgR_resized, confidence = 0.6)
    if gMensagensRoxo:
        pa.moveTo(gMensagensRoxo)
        pa.click()
        t.sleep(2)
    else:
        print("NÃ£o encontrei o Google Mensagens")

except TypeError:
    t.sleep(3)
    acharGMensagens = pa.locateCenterOnScreen(gMsg_resized, confidence = 0.6) 
    if acharGMensagens:
        pa.moveTo(acharGMensagens)
        pa.click()
        t.sleep(2)
    else:
        print("NÃ£o encontrei o Google Mensagens")

pa.hotkey("alt", "tab")

for i in range(5):
    
    pa.hotkey("ctrl","c")
    t.sleep(1)
    pa.hotkey("alt","tab")
    t.sleep(1)

    imagem = pa.locateCenterOnScreen(iniciarChat_resized, confidence = 0.7)
    x,y = imagem
    
    pa.moveTo(x,y)
    pa.click(x,y)
    t.sleep(1)

    proNumero = pa.locateCenterOnScreen(digiteUm_resized, confidence = 0.5)
    x, y = proNumero
    pa.moveTo(x,y)
    pa.click(x,y)
    t.sleep(1)

    pa.hotkey("ctrl","v")
    t.sleep(5)
    pa.press("enter")
    t.sleep(4)

    pa.typewrite("Ola! Tudo bem? Sou Pedro, correspondente bancario do Grupo Meirelles.  Apresentamos o nosso produto: COMPRA DE DIVIDAS!! Eliminamos seu nome negativado e regularizamos atrasos âœ…. Reduzimos as taxas de juros ðŸ“‰. Unificamos suas parcelas sem acrescimos. Libere um troco extra ðŸ’µ.  Faca uma simulacao e descubra como liberar dinheiro este mes! Entre em contato em https://w.app/grupomeirelles para mais informacoes!")
    t.sleep(4)
    pa.press("enter")
    t.sleep(2)
    pa.hotkey("alt","tab")  
    t.sleep(.6)
    pa.hotkey("ctrl","right")
    t.sleep(1)
    pa.press("a")
    t.sleep(1)
    pa.press("enter")
    t.sleep(1)
    pa.hotkey("ctrl","left")
    t.sleep(1) 

os.remove(gMsg_resized)
os.remove(gMsgR_resized)
os.remove(iniciarChat_resized)
os.remove(digiteUm_resized)
